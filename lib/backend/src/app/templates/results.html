{% extends 'base.html' %}
{% from "forms/macros.html" import render_field %}

{% block dashboard %}
<section class='container'>
  <div align="center" class="row">
  
    <!-- {% if valid_results %}
    <div class="progress progress-striped active">
      <div class="progress-bar" style="width: {{progress}}%"></div>
    </div>
    <div class="alert alert-dismissible alert-success">
      <p>Go to <a href="{{ redirect_url }}">this Grafana URL</a> to find
        the visualization dashboard for your data
      </p>
    </div>
    {% endif %} -->


    <div class="panel panel-info">

      <div class="panel-heading">
        <h3 class="panel-title">Results</h3>
      </div>

      <div class="panel-body">

        <table id="results_table" name="upload_results" class="table table-striped table-hover">
          <thead>
            <tr>
              <td><span class="label label-default">Filename</span></td>
              <td><span class="label label-default">Sysstat Version</span></td>
              <td><span class="label label-default">Hostname</span></td>
              <td><span class="label label-default">Status</span></td>
            </tr>
          </thead>
          <tbody>

            <script type="text/javascript" charset="utf-8">
        // var sessionID = {{data["sessionId"]}};
        // document.write(sessionID);
    var socket = io.connect('http://' + document.domain + ':' + location.port + "/get_result");
    var sessionID = "{{data["sessionID"]}}"
    var fileCount = "{{data["file_count"]}}"
    fileList = {{data["file_list"] | safe}}
    var searchKeys = []
    socket.on('connect', function() {
        // document.write(sessionID);

        socket.emit('get results', {"sessionID" : sessionID, "tota_files" : fileCount, "file_list" : fileList});
        var black_list = []
        for (var i = 0; i < file_list; i++) {
          socket.emit('get results', {"sessionID" : sessionID, "file" : file_list[i]});
          
      }


    });

    socket.on('response', function(response_json) {
      searchKeys = Object.keys(response_json);
      var tbody = document.getElementById('results_table');
                
    // check if the property/key is defined in the object itself, not in parent
    // if (response_json.hasOwnProperty(key)) {           
    //     key, response_json[key];
    var black_list = []
    for (var i = 0; i < file_list; i++) {
    
    }
    file_data = response_json;
    
    var tr = "<tr id="+ file_data.filename + ">";
        var filename;
        var status;
        if (file_data["if_valid"]) {  
          filename = "<span class='label label-success'>" + file_data.filename + "</span>";
          status = "<span class='label label-primary'>Begin:</span>" + file_data.tstamp_beg + "<span class='label label-primary'>End:</span>" + file_data.tstamp_end;
        } 
        else{
          filename = "<span class='label label-danger'>" + file_data.filename + "</span>";
          status = "<pre style='white-space:pre-wrap;''>"+ "Invalid File" + '</pre>';
        }  


    //     key, response_json[key];
        tr += "<td id=filename>" + filename + "</td>" + "<td id=systat >" + file_data.sadf_type_det + "</td>" + "<td id=hostname>" + file_data.nodename + "</td> + <td id=status>" + status + "</td></tr>";
    // }
    $("#results_table tbody").append(tr);
});
socket.on('poll', function() {
      
                for (var key in searchKeys) {
    socket.emit('poll check', {"SearchKey": key});
}

    
});

    // socket.on('connect', function() {
    //     socket.emit('my event', {data: 'I\'m connected!'});
    // });
</script>
           <!--  {% for item in data %}
            console.log(item)

            <tr>
              <td>
                {% if item.0 %}
                <span class="label label-success">{{ item.1 }}</span>
                {% else %}
                <span class="label label-danger">{{ item.1 }}</span>
                {% endif %}
              </td>
              <td>
                {{ item.2 }}
              </td>
              <td>
                {{ item.3 }}
              </td>
              <td>
                {% if item.0 %}
                {% else %}
                <pre style="white-space:pre-wrap;">{{ item.4 }}</pre>
                {% endif %}
              </td>
            </tr>
            {% endfor %} -->
          </tbody>
        </table>

      </div>
    </div>
  </div>

</section>
{% endblock %}
